# Testwork **Fanbox**
## Задание:
> <https://dl.fun-box.ru/qt-ruby.pdf> 

## Level 2
**1 (**
  Есть 3 пути хранения изображения.

  1. Файловая система
  2. `DBMS`
  3. Удаленный Storage сервер, например `Amazon S3`.

  Я не буду рассматривать готовое решение, поэтому 3 вариант я не беру.

### Файловая система

  Достоинства:

  * Отлично подходит для небольших и средних проектов.
  Файловая система может отлично раздавать статику `nginx` или `lighttpd`

  * Можем загружать файл через nginx.

  Недостатки:

  * С появлением большого числа файлов появляются проблемы.
  * В некоторых файловых системах мы решаем сложности разбивая на под каталоги.
    Однако. Такой вариант правильный только в устаревших FS типа `FAT` & `NTFS`.
    Время доступа к произвольному файлу в `EXT` пропорционально O(log(N)), и если впихнуть туда каталоги, то будет только хуже и сложнее. 
    Там и так дерево, и надстройка, дерево над деревом будет только тормозить.
  * В директориях с большим количеством файлов плохо выполняются операции `ls`, `rm -rf *`
  * Метоинформация хранится в `DBMS`, а файл в файловой системе. 2 состояния. Сложнее выявить ошибку если файл удалили, а запись существует.
  * Делать бекапы сложнее.

### `DBMS`

  Достоинства:

  * Данные и файл хранятся в 1 месте, что в случие потери легче заметить.
    И востнановить.
  * Можно делать Шардинг.
  * Легче делать бекапы.
  * Поиск требуемого файла, быстрее.
  * Возможность шифрования файлов
  * Безопасность, если файл был заражен, то его можно выполнить.
    В `DBMS` же будет лежать мертвым грузом.
    Хотя и в файловой системе его можно сделать не исполняемым.
    И для клиентов угрозы не снимет.

  Недостатки:

  * Nginx лучше работает со статикой.

### Вывод

  Так-ка большинство проблем файловой системы связаны с количеством файлов. То на средних системах выбор очевиден.
  Однако на большом количестве, всеже выбираю `DBMS`.
  Выбор - `Gridfs в mongodb`

### Библиотека

  `Сarrierwave` - хорошая библиотека с большим сообществом.
  Конкуренты: `Paperclip`, `Dragonfly`, `Refile`
  https://github.com/carrierwaveuploader/carrierwave-mongoid
  Можем проверить на вирус новый файл.

### Аватарки

  Аватарки мы ужимаем до требуемого размера(имеется в виду размер рамки)
  Можем также вобще доверится стороннему сервису Gavatar.

### Проверки на nginx

  Самые очевидные - это размер и тип файла.
  Тем самым снимем нагрузку на сервер.

